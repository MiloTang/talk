  
	
<style type="text/css">
p, li { white-space: pre-wrap; }
</style>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;"></span>PDO::ERRMODE_SILENT</pre>

<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>此为默认模式。<span style=" color:#c0c0c0;"> </span>PDO<span style=" color:#c0c0c0;"> </span>将只简单地设置错误码，可使用<span style=" color:#c0c0c0;"> </span>PDO::errorCode()<span style=" color:#c0c0c0;"> </span>和<span style=" color:#c0c0c0;"> </span>PDO::errorInfo()<span style=" color:#c0c0c0;"> </span>方法来检查语句和数据库对象。如果错误是由于对语句对象的调用而产生的，那么可以调用那个对象的<span style=" color:#c0c0c0;"> </span>PDOStatement::errorCode()<span style=" color:#c0c0c0;"> </span>或<span style=" color:#c0c0c0;"> </span>PDOStatement::errorInfo()<span style=" color:#c0c0c0;"> </span>方法。如果错误是由于调用数据库对象而产生的，那么可以在数据库对象上调用上述两个方法。</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;"></span>PDO::ERRMODE_WARNING</pre>

<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>除设置错误码之外，PDO<span style=" color:#c0c0c0;"> </span>还将发出一条传统的<span style=" color:#c0c0c0;"> </span>E_WARNING<span style=" color:#c0c0c0;"> </span>信息。如果只是想看看发生了什么问题且不中断应用程序的流程，那么此设置在调试/测试期间非常有用。</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>PDO::ERRMODE_EXCEPTION</pre>

<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>除设置错误码之外，PDO<span style=" color:#c0c0c0;"> </span>还将抛出一个<span style=" color:#c0c0c0;"> </span>PDOException<span style=" color:#c0c0c0;"> </span>异常类并设置它的属性来反射错误码和错误信息。此设置在调试期间也非常有用，因为它会有效地放大脚本中产生错误的点，从而可以非常快速地指出代码中有问题的潜在区域（记住：如果异常导致脚本终止，则事务被自动回滚）。</pre>

<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>异常模式另一个非常有用的是，相比传统<span style=" color:#c0c0c0;"> </span>PHP<span style=" color:#c0c0c0;"> </span>风格的警告，可以更清晰地构建自己的错误处理，而且比起静默模式和显式地检查每种数据库调用的返回值，异常模式需要的代码/嵌套更少。<span style=" color:#c0c0c0;"> </span></pre>

<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">创建<span style=" color:#c0c0c0;"> </span>PDO<span style=" color:#c0c0c0;"> </span>实例并设置错误模式</pre>

<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#000080;">&lt;?php</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">$dsn<span style=" color:#c0c0c0;"> </span>=<span style=" color:#c0c0c0;"> </span>'mysql:dbname=testdb;host=127.0.0.1';</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">$user<span style=" color:#c0c0c0;"> </span>=<span style=" color:#c0c0c0;"> </span>'dbuser';</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">$password<span style=" color:#c0c0c0;"> </span>=<span style=" color:#c0c0c0;"> </span>'dbpass';</pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">try<span style=" color:#c0c0c0;"> </span>{</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>$dbh<span style=" color:#c0c0c0;"> </span>=<span style=" color:#c0c0c0;"> </span>new<span style=" color:#c0c0c0;"> </span>PDO($dsn,<span style=" color:#c0c0c0;"> </span>$user,<span style=" color:#c0c0c0;"> </span>$password);</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>$dbh-&gt;setAttribute(PDO::ATTR_ERRMODE,<span style=" color:#c0c0c0;"> </span>PDO::ERRMODE_EXCEPTION);</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">}<span style=" color:#c0c0c0;"> </span>catch<span style=" color:#c0c0c0;"> </span>(PDOException<span style=" color:#c0c0c0;"> </span>$e)<span style=" color:#c0c0c0;"> </span>{</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>echo<span style=" color:#c0c0c0;"> </span>'Connection<span style=" color:#c0c0c0;"> </span>failed:<span style=" color:#c0c0c0;"> </span>'<span style=" color:#c0c0c0;"> </span>.<span style=" color:#c0c0c0;"> </span>$e-&gt;getMessage();</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">}</pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#000080;">?&gt;</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">注意：<span style=" color:#c0c0c0;"> </span>不管当前是否设置了<span style=" color:#c0c0c0;"> </span>PDO::ATTR_ERRMODE<span style=" color:#c0c0c0;"> </span>，如果连接失败，PDO::__construct()<span style=" color:#c0c0c0;"> </span>将总是抛出一个<span style=" color:#c0c0c0;"> </span>PDOException<span style=" color:#c0c0c0;"> </span>异常。未捕获异常是致命的。</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">创建<span style=" color:#c0c0c0;"> </span>PDO<span style=" color:#c0c0c0;"> </span>实例并在构造函数中设置错误模式</pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#000080;">&lt;?php</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">$dsn<span style=" color:#c0c0c0;"> </span>=<span style=" color:#c0c0c0;"> </span>'mysql:dbname=test;host=127.0.0.1';</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">$user<span style=" color:#c0c0c0;"> </span>=<span style=" color:#c0c0c0;"> </span>'googleguy';</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">$password<span style=" color:#c0c0c0;"> </span>=<span style=" color:#c0c0c0;"> </span>'googleguy';</pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">/*</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>使用<span style=" color:#c0c0c0;"> </span>try/catch<span style=" color:#c0c0c0;"> </span>围绕构造函数仍然有效，即使设置了<span style=" color:#c0c0c0;"> </span>ERRMODE<span style=" color:#c0c0c0;"> </span>为<span style=" color:#c0c0c0;"> </span>WARNING，</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>因为如果连接失败，PDO::__construct<span style=" color:#c0c0c0;"> </span>将总是抛出一个<span style=" color:#c0c0c0;">  </span>PDOException<span style=" color:#c0c0c0;"> </span>异常。</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">*/</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">try<span style=" color:#c0c0c0;"> </span>{</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>$dbh<span style=" color:#c0c0c0;"> </span>=<span style=" color:#c0c0c0;"> </span>new<span style=" color:#c0c0c0;"> </span>PDO($dsn,<span style=" color:#c0c0c0;"> </span>$user,<span style=" color:#c0c0c0;"> </span>$password,<span style=" color:#c0c0c0;"> </span>array(PDO::ATTR_ERRMODE<span style=" color:#c0c0c0;"> </span>=&gt;<span style=" color:#c0c0c0;"> </span>PDO::ERRMODE_WARNING));</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">}<span style=" color:#c0c0c0;"> </span>catch<span style=" color:#c0c0c0;"> </span>(PDOException<span style=" color:#c0c0c0;"> </span>$e)<span style=" color:#c0c0c0;"> </span>{</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>echo<span style=" color:#c0c0c0;"> </span>'Connection<span style=" color:#c0c0c0;"> </span>failed:<span style=" color:#c0c0c0;"> </span>'<span style=" color:#c0c0c0;"> </span>.<span style=" color:#c0c0c0;"> </span>$e-&gt;getMessage();</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#c0c0c0;">    </span>exit;</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">}</pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">//<span style=" color:#c0c0c0;"> </span>这里将导致<span style=" color:#c0c0c0;"> </span>PDO<span style=" color:#c0c0c0;"> </span>抛出一个<span style=" color:#c0c0c0;"> </span>E_WARNING<span style=" color:#c0c0c0;"> </span>级别的错误，而不是<span style=" color:#c0c0c0;"> </span>一个异常<span style=" color:#c0c0c0;"> </span>（当数据表不存在时）</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">$dbh-&gt;query("SELECT<span style=" color:#c0c0c0;"> </span>wrongcolumn<span style=" color:#c0c0c0;"> </span>FROM<span style=" color:#c0c0c0;"> </span>wrongtable");</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#000080;">?&gt;</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">以上例程会输出：</pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Warning:<span style=" color:#c0c0c0;"> </span>PDO::query():<span style=" color:#c0c0c0;"> </span>SQLSTATE[42S02]:<span style=" color:#c0c0c0;"> </span>Base<span style=" color:#c0c0c0;"> </span>table<span style=" color:#c0c0c0;"> </span>or<span style=" color:#c0c0c0;"> </span>view<span style=" color:#c0c0c0;"> </span>not<span style=" color:#c0c0c0;"> </span>found:<span style=" color:#c0c0c0;"> </span>1146<span style=" color:#c0c0c0;"> </span>Table<span style=" color:#c0c0c0;"> </span>'test.wrongtable'<span style=" color:#c0c0c0;"> </span>doesn't<span style=" color:#c0c0c0;"> </span>exist<span style=" color:#c0c0c0;"> </span>in</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">/tmp/pdo_test.php<span style=" color:#c0c0c0;"> </span>on<span style=" color:#c0c0c0;"> </span>line<span style=" color:#c0c0c0;"> </span>18</pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">add<span style=" color:#c0c0c0;"> </span>a<span style=" color:#c0c0c0;"> </span>note<span style=" color:#c0c0c0;"> </span>add<span style=" color:#c0c0c0;"> </span>a<span style=" color:#c0c0c0;"> </span>note</pre>