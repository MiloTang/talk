  
	  
	<pre style="background-color:#fdf6e3;color:#586e75;font-family:'Source Code Pro';font-size:13.5pt;">pack/unpack<span style="font-family:'Courier New';">详解</span><span style="font-family:'Courier New';"><br></span>a -- <span style="font-family:'Courier New';">将字符串空白以 </span>NULL <span style="font-family:'Courier New';">字符填满</span><span style="font-family:'Courier New';"><br></span>A -- <span style="font-family:'Courier New';">将字符串空白以 </span>SPACE <span style="font-family:'Courier New';">字符 </span>(<span style="font-family:'Courier New';">空格</span>) <span style="font-family:'Courier New';">填满</span><span style="font-family:'Courier New';"><br></span>h -- 16<span style="font-family:'Courier New';">进制字符串，低位在前以半字节为单位</span><span style="font-family:'Courier New';"><br></span>H -- 16<span style="font-family:'Courier New';">进制字符串，高位在前以半字节为单位</span><span style="font-family:'Courier New';"><br></span>c -- <span style="font-family:'Courier New';">有符号字符</span><span style="font-family:'Courier New';"><br></span>C -- <span style="font-family:'Courier New';">无符号字符</span><span style="font-family:'Courier New';"><br></span>s -- <span style="font-family:'Courier New';">有符号短整数 </span>(16<span style="font-family:'Courier New';">位，主机字节序</span>)<br>S -- <span style="font-family:'Courier New';">无符号短整数 </span>(16<span style="font-family:'Courier New';">位，主机字节序</span>)<br>n -- <span style="font-family:'Courier New';">无符号短整数 </span>(16<span style="font-family:'Courier New';">位</span>, <span style="font-family:'Courier New';">大端字节序</span>)<br>v -- <span style="font-family:'Courier New';">无符号短整数 </span>(16<span style="font-family:'Courier New';">位</span>, <span style="font-family:'Courier New';">小端字节序</span>)<br>i -- <span style="font-family:'Courier New';">有符号整数 </span>(<span style="font-family:'Courier New';">依赖机器大小及字节序</span>)<br>I -- <span style="font-family:'Courier New';">无符号整数 </span>(<span style="font-family:'Courier New';">依赖机器大小及字节序</span>)<br>l -- <span style="font-family:'Courier New';">有符号长整数 </span>(32<span style="font-family:'Courier New';">位，主机字节序</span>)<br>L -- <span style="font-family:'Courier New';">无符号长整数 </span>(32<span style="font-family:'Courier New';">位，主机字节序</span>)<br>N -- <span style="font-family:'Courier New';">无符号长整数 </span>(32<span style="font-family:'Courier New';">位</span>, <span style="font-family:'Courier New';">大端字节序</span>)<br>V -- <span style="font-family:'Courier New';">无符号长整数 </span>(32<span style="font-family:'Courier New';">位</span>, <span style="font-family:'Courier New';">小端字节序</span>)<br>f -- <span style="font-family:'Courier New';">单精度浮点数 </span>(<span style="font-family:'Courier New';">依计算机的范围</span>)<br>d -- <span style="font-family:'Courier New';">双精度浮点数 </span>(<span style="font-family:'Courier New';">依计算机的范围</span>)<br>x -- <span style="font-family:'Courier New';">空字节</span><span style="font-family:'Courier New';"><br></span>X -- <span style="font-family:'Courier New';">倒回一位</span><span style="font-family:'Courier New';"><br></span>@ -- <span style="font-family:'Courier New';">填入 </span>NULL <span style="font-family:'Courier New';">字符到绝对位置<br></span><br>a与A的区别<br><span style="color:#dc322f;">&lt;?php<br></span><span style="color:#839496;">error_reporting</span>(<span style="color:#d33682;">E_ALL</span>);<br><span style="color:#268bd2;">$host </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">"127.0.0.1"</span>;<br><span style="color:#268bd2;">$port </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">"9999"</span>;<br><span style="color:#268bd2;">$socket </span><span style="color:#079a71;">= </span><span style="color:#839496;">socket_create</span>(<span style="color:#d33682;">AF_INET</span>, <span style="color:#d33682;">SOCK_STREAM</span>, <span style="color:#d33682;">SOL_TCP</span>)<br><span style="color:#859900;">or die</span>(<span style="color:#2aa198;">"Unable to create socket</span><span style="color:#d33682;font-weight:bold;">\n</span><span style="color:#2aa198;">"</span>);<br><span style="color:#839496;">socket_connect</span>(<span style="color:#268bd2;">$socket</span>, <span style="color:#268bd2;">$host</span>, <span style="color:#268bd2;">$port</span>) <span style="color:#859900;">or die</span>(<span style="color:#2aa198;">"Connect error.</span><span style="color:#d33682;font-weight:bold;">\n</span><span style="color:#2aa198;">"</span>);<br><span style="color:#268bd2;">$err </span><span style="color:#079a71;">= </span><span style="color:#839496;">socket_last_error</span>(<span style="color:#268bd2;">$socket</span>);<br><span style="color:#859900;">if </span>(<span style="color:#268bd2;">$err</span>)<br><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">   </span><span style="color:#839496;">socket_close</span>(<span style="color:#268bd2;">$socket</span>);<br>   <span style="color:#859900;">die</span>(<span style="color:#839496;">socket_strerror</span>(<span style="color:#268bd2;">$err</span>) <span style="color:#079a71;">. </span><span style="color:#2aa198;">"</span><span style="color:#d33682;font-weight:bold;">\n</span><span style="color:#2aa198;">"</span>);<br><span style="color:#dc322f;">}<br></span><span style="color:#268bd2;">$bin </span><span style="color:#079a71;">= </span><span style="color:#839496;">pack</span>(<span style="color:#2aa198;">"A50"</span>, <span style="color:#2aa198;">"PHP</span><span style="color:#2aa198;font-family:'Courier New';">到</span><span style="color:#2aa198;">Golang</span><span style="color:#2aa198;font-family:'Courier New';">服务器</span><span style="color:#2aa198;">"</span>);<br><span style="color:#268bd2;">$len </span><span style="color:#079a71;">= </span><span style="color:#839496;">socket_write </span>(<span style="color:#268bd2;">$socket </span>, <span style="color:#268bd2;">$bin</span>, <span style="color:#839496;">strlen</span>(<span style="color:#268bd2;">$bin</span>));<br><span style="color:#839496;">socket_close</span>(<span style="color:#268bd2;">$socket</span>);<br><br><br><span style=" font-weight:600; color:#000080;">package</span><span style=" color:#c0c0c0;"> </span>main
<br>
<span style=" font-weight:600; color:#000080;">import</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">(</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" color:#008000;">"log"</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" color:#008000;">"net"</span>
<span style=" color:#000000;">)</span>
<br>
<span style=" font-weight:600; color:#000080;">func</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">init()</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">{</span>
<br>
<span style=" color:#000000;">}</span>
<br>
<span style=" font-weight:600; color:#000080;">const</span><span style=" color:#c0c0c0;"> </span>BUF_SIZE<span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">=</span><span style=" color:#c0c0c0;"> </span><span style=" color:#800080;">50</span>
<br>
<span style=" font-weight:600; color:#000080;">func</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">main()</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">{</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>l<span style=" color:#000000;">,</span><span style=" color:#c0c0c0;"> </span>err<span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">:=</span><span style=" color:#c0c0c0;"> </span>net<span style=" color:#000000;">.</span>Listen<span style=" color:#000000;">(</span><span style=" color:#008000;">"tcp"</span><span style=" color:#000000;">,</span><span style=" color:#c0c0c0;"> </span><span style=" color:#008000;">":9999"</span><span style=" color:#000000;">)</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" font-weight:600; color:#000080;">if</span><span style=" color:#c0c0c0;"> </span>err<span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">!=</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000080;">nil</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">{</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log<span style=" color:#000000;">.</span>Println<span style=" color:#000000;">(</span>err<span style=" color:#000000;">)</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" color:#000000;">}</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" font-weight:600; color:#000080;">for</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">{</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>conn<span style=" color:#000000;">,</span><span style=" color:#c0c0c0;"> </span>e<span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">:=</span><span style=" color:#c0c0c0;"> </span>l<span style=" color:#000000;">.</span>Accept<span style=" color:#000000;">()</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" font-weight:600; color:#000080;">if</span><span style=" color:#c0c0c0;"> </span>e<span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">!=</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000080;">nil</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">{</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log<span style=" color:#000000;">.</span>Println<span style=" color:#000000;">(</span>e<span style=" color:#000000;">)</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" color:#000000;">}</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" font-weight:600; color:#000080;">go</span><span style=" color:#c0c0c0;"> </span>handleConn<span style=" color:#000000;">(</span>conn<span style=" color:#000000;">)</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" color:#000000;">}</span>
<span style=" color:#000000;">}</span>
<span style=" font-weight:600; color:#000080;">func</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">handleConn(</span>conn<span style=" color:#c0c0c0;"> </span>net<span style=" color:#000000;">.</span>Conn<span style=" color:#000000;">)</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">{</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" font-weight:600; color:#000080;">defer</span><span style=" color:#c0c0c0;"> </span>conn<span style=" color:#000000;">.</span>Close<span style=" color:#000000;">()</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>buf<span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">:=</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000080;">make</span><span style=" color:#000000;">([]</span><span style=" color:#000080;">byte</span><span style=" color:#000000;">,</span><span style=" color:#c0c0c0;"> </span>BUF_SIZE<span style=" color:#000000;">)</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>n<span style=" color:#000000;">,</span><span style=" color:#c0c0c0;"> </span>err<span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">:=</span><span style=" color:#c0c0c0;"> </span>conn<span style=" color:#000000;">.</span>Read<span style=" color:#000000;">(</span>buf<span style=" color:#000000;">)</span>
<br>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" font-weight:600; color:#000080;">if</span><span style=" color:#c0c0c0;"> </span>err<span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">!=</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000080;">nil</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000000;">{</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log<span style=" color:#000000;">.</span>Printf<span style=" color:#000000;">(</span><span style=" color:#008000;">"err:</span><span style=" color:#c0c0c0;"> </span><span style=" color:#008000;">%v\n"</span><span style=" color:#000000;">,</span><span style=" color:#c0c0c0;"> </span>err<span style=" color:#000000;">)</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" font-weight:600; color:#000080;">return</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=" color:#000000;">}</span>
<span style=" color:#c0c0c0;">&nbsp;&nbsp;&nbsp;&nbsp;</span>log<span style=" color:#000000;">.</span>Printf<span style=" color:#000000;">(</span><span style=" color:#008000;">"\n已接收：%d个字节，数据是：'%s'\n"</span><span style=" color:#000000;">,</span><span style=" color:#c0c0c0;"> </span>n<span style=" color:#000000;">,</span><span style=" color:#c0c0c0;"> </span><span style=" color:#000080;">string</span><span style=" color:#000000;">(</span>buf<span style=" color:#000000;">))</span>
<span style=" color:#000000;">}</span>
<span style=" color:#000000; background-color:#ffffff;">已接收：50个字节，数据是：'PHP到Golang服务器                             '<br></span>把A50改为a50 之后服务器端的结果是:<br><span style=" color:#000000; background-color:#ffffff;">已接收：50个字节，数据是：'PHP到Golang服务器<br><br></span><span style="color:#859900;">h与H的区别<br>echo </span><span style="color:#839496;">pack</span>(<span style="color:#2aa198;">'h'</span>,<span style="color:#2aa198;">0x7</span>);<br><span style="color:#859900;">echo </span><span style="color:#839496;">pack</span>(<span style="color:#2aa198;">'H'</span>,<span style="color:#2aa198;">0x7</span>);<br>第一个输出时一个不可见字符，第二个是一个小写的字符p，其实就是<span style="color:#2aa198;">0x07</span>与<span style="color:#2aa198;">0x7</span>0区别<br><br>使用pack包来判断机器是大端模式还是小端模式<br><span style="color:#859900;">function </span><span style="color:#839496;">IsBig</span>()<br><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    </span><span style="color:#268bd2;">$bin </span><span style="color:#079a71;">= </span><span style="color:#839496;">pack</span>(<span style="color:#2aa198;">'L'</span>, <span style="color:#2aa198;">0x12345678</span>);<br>    <span style="color:#268bd2;">$hex </span><span style="color:#079a71;">= </span><span style="color:#839496;">bin2hex</span>(<span style="color:#268bd2;">$bin</span>);<br>    <span style="color:#859900;">if </span>(<span style="color:#839496;">ord</span>(<span style="color:#839496;">pack</span>(<span style="color:#2aa198;">'H2'</span>, <span style="color:#268bd2;">$hex</span>)) <span style="color:#079a71;">=== </span><span style="color:#2aa198;">0x78</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return FALSE</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">return TRUE</span>;<br><span style="color:#dc322f;">}<br></span><span style="color:#dc322f;"><br></span><span style="color:#859900;">if </span>(<span style="color:#839496;">IsBig</span>())<br><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">echo </span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">大端序</span><span style="color:#2aa198;">'</span>;<br><span style="color:#dc322f;">}<br></span><span style="color:#859900;">else<br></span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">echo </span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">小端序</span><span style="color:#2aa198;">'</span>;<br><span style="color:#dc322f;">}<br></span><br>unpack() 函数从二进制字符串对数据进行解包。<br><span style="color:#839496;background-color:#ccccff;">print_r</span>((<span style="color:#839496;">unpack</span>(<span style="color:#2aa198;">'C*'</span>,<span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">道可道</span><span style="color:#2aa198;">'</span>)));<br>UTF-8编码下输出：<br>Array(
    [1] =&gt; 233
    [2] =&gt; 129
    [3] =&gt; 147
    [4] =&gt; 229
    [5] =&gt; 143
    [6] =&gt; 175
    [7] =&gt; 233
    [8] =&gt; 129
    [9] =&gt; 147
)
<br><br></pre>