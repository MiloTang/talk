  
	<pre style="background-color:#fdf6e3;color:#586e75;font-family:'Courier New';font-size:13.5pt;">更新依赖包以及安装编译环境<br><span style="font-family:'Source Code Pro';">yum -y install m4 autoconf automake libtool</span><span style="font-family:'Source Code Pro';"></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">yum -y install gcc gcc-c++ wget</span><span style="font-family:'Source Code Pro';"></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">yum -y install mysql-devel<br></span><span style="font-family:'Source Code Pro';"><br></span>下载<span style="font-family:'Source Code Pro';">coreseek</span><span style="font-family:'Source Code Pro';"></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">wget http://www.coreseek.cn/uploads/csft/3.2/coreseek-3.2.14.tar.gz</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">##mmseg3</span>是一个中文分词插件<br><span style="font-family:'Source Code Pro';">tar xzvf coreseek-3.2.14.tar.gz</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">cd coreseek-3.2.14</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">cd mmseg-3.2.14/</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">./bootstrap</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">./configure --prefix=/usr/local/mmseg3</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">make</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">make install</span><span style="font-family:'Source Code Pro';"></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">cd ../csft-3.2.14/</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sh buildconf.sh</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">./configure --prefix=/usr/local/coreseek --without-python --without-unixodbc --with-mmseg --with-mmseg-includes=/usr/local/mmseg3/include/mmseg/ --with-mmseg-libs=/usr/local/mmseg3/lib/ --with-mysql --host=arm</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">vi src/sphinxexpr.cpp</span><span style="font-family:'Source Code Pro';"></span><span style="font-family:'Source Code Pro';"><br></span>然后将所有的<span style="font-family:'Source Code Pro';">T val = ExprEval ( this-&gt;m_pArg, tMatch ).....</span>修改为<br><span style="font-family:'Source Code Pro';">T val = this-&gt;ExprEval ( this-&gt;m_pArg, tMatch )</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">make</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">make install</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">cd /usr/local/coreseek/etc</span><span style="font-family:'Source Code Pro';"></span><span style="font-family:'Source Code Pro';"><br></span>进入配置目录通过命令<span style="font-family:'Source Code Pro';">ls</span>可以看到<span style="font-family:'Source Code Pro';">3</span>个文件<br><span style="font-family:'Source Code Pro';">example.sql  sphinx.conf.dist  sphinx-min.conf.dist</span><span style="font-family:'Source Code Pro';"><br></span>其中<span style="font-family:'Source Code Pro';">example.sql</span>是示例<span style="font-family:'Source Code Pro';">sql</span>脚本我们将其导入到数据库中的<span style="font-family:'Source Code Pro';">test</span>数据库中作为测试数据<span style="font-family:'Source Code Pro';">(</span>会创建两张表 <span style="font-family:'Source Code Pro';">documents</span>和<span style="font-family:'Source Code Pro';">tags)</span><span style="font-family:'Source Code Pro';"></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">vi sphinx.conf</span><span style="font-family:'Source Code Pro';"><br></span>输入以下内容<br><span style="font-family:'Source Code Pro';">source src1</span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">{<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">type               = mysql<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_host            = localhost<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_user            = root<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_pass            = vagrant<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_db             = test<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_port            = 3306 # optional, default is 3306<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_sock                                = /tmp/mysql.sock<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_query_pre           = SET NAMES utf8<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_query           = \<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">SELECT id, group_id, UNIX_TIMESTAMP(date_added) AS date_added, title, content \<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">FROM documents<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_attr_uint        = group_id<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_attr_timestamp    = date_added<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">sql_query_info       = SELECT * FROM documents WHERE id=$id<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">}<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">index test1<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">{<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">source             = src1<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">path               = /usr/local/coreseek/var/data/test1<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">docinfo                = extern<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">charset_type         = zh_cn.utf-8<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">mlock        = 0<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">morphology    = none<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">min_word_len      = 1<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">html_strip    = 0<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">charset_dictpath      = /usr/local/mmseg3/etc/<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">ngram_len                    = 0<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">}<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">indexer<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">{<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">mem_limit           = 32M<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">}<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">searchd<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">{<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">port               = 9312<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">log                   = /usr/local/coreseek/var/log/searchd.log<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">query_log           = /usr/local/coreseek/var/log/query.log<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">read_timeout         = 5<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">max_children         = 30<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">pid_file            = /usr/local/coreseek/var/log/searchd.pid<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">max_matches             = 1000<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">seamless_rotate          = 1<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">preopen_indexes          = 0<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">unlink_old          = 1<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">}<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';"><br></span>说明<span style="font-family:'Source Code Pro';">:<br></span><span style="font-family:'Source Code Pro';"><br></span>代码段<span style="font-family:'Source Code Pro';">source src1{***} </span>代表数据源里面主要包含了数据库的配置信息，<span style="font-family:'Source Code Pro';">src1</span>表示数据源名字<span style="font-family:'Source Code Pro';">,</span>可以随便写。<br><br>代码段<span style="font-family:'Source Code Pro';">index test1{***} </span>代表为哪个数据源创建索引<span style="font-family:'Source Code Pro';">,</span>与<span style="font-family:'Source Code Pro';">source *** </span>是成对出现的，其中的<span style="font-family:'Source Code Pro';">source</span>参数的值必须是某一个数据源的名字。<br><br>其他参数可以查看手册，这里不再赘述。<br><br>生成索引<br><br><span style="font-family:'Source Code Pro';">/usr/local/coreseek/bin/indexer -c /usr/local/coreseek/etc/sphinx.conf --all<br></span><span style="font-family:'Source Code Pro';"><br></span>启动命令<br><br><span style="font-family:'Source Code Pro';">/usr/local/coreseek/bin/searchd -c /usr/local/coreseek/etc/sphinx.conf<br></span><span style="font-family:'Source Code Pro';"><br></span>其中参数<span style="font-family:'Source Code Pro';">--all</span>表示生成所有索引<br><br>当然也可以是索引的名字例如：。<br><br>执行后可以在<span style="font-family:'Source Code Pro';">/usr/local/coreseek/var/data</span>目录中看到多出一些文件<span style="font-family:'Source Code Pro';">,</span>是以索引名为文件名的不同的扩展名的文件<br><br>在不启动<span style="font-family:'Source Code Pro';">sphinx</span>的情况下即可测试命令<span style="font-family:'Source Code Pro';">:<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">/usr/local/coreseek/bin/search -c /usr/local/coreseek/etc/sphinx.conf </span>广东<br><br><br><span style="font-family:'Source Code Pro';">windows</span>下创建<span style="font-family:'Source Code Pro';">sphinx<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">1</span>、进入<span style="font-family:'Source Code Pro';">coreseek</span>文件夹下<br><br><span style="font-family:'Source Code Pro';">2</span>、创建索引   <span style="font-family:'Source Code Pro';">.\bin\indexer.exe -c .\etc\</span>配置文件名字 <span style="font-family:'Source Code Pro';">--all<br></span><span style="font-family:'Source Code Pro';"><br></span><span style="font-family:'Source Code Pro';">3</span>、开启索引   <span style="font-family:'Source Code Pro';">.\bin\searchd.exe -c .\etc\</span>配置文件<br><br><span style="font-family:'Source Code Pro';">4</span>、如果用<span style="font-family:'Source Code Pro';">docs</span>操作进行搜索  ：  <span style="font-family:'Source Code Pro';">.\bin\search.exe -c .\etc\</span>配置文件名字  搜索关键值</pre>