  
	<pre style="background-color:#fdf6e3;color:#586e75;font-family:'Source Code Pro';font-size:13.5pt;"><span style="color:#dc322f;">&lt;?php<br></span><span style="color:#859900;">namespace </span><span style="color:#839496;">Core</span>\<span style="color:#839496;">libs</span>;<br><span style="color:#839496;">defined</span>(<span style="color:#2aa198;">'CORE_PATH'</span>) <span style="color:#859900;">or exit</span>();<br><span style="color:#859900;">class </span><span style="color:#b58900;">BaseController<br></span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private </span><span style="color:#6c71c4;">$_data</span>;<br>    <span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@param </span><span style="color:#93a1a1;font-style:italic;">string $name<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@param </span><span style="color:#93a1a1;font-style:italic;">$data<br></span><span style="color:#93a1a1;font-style:italic;">     */<br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">public final function </span><span style="color:#839496;">assign</span>(<span style="color:#839496;">string $name</span>,<span style="color:#839496;">$data</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_data</span><span style="color:#268bd2;">[</span><span style="color:#839496;">$name</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">=</span><span style="color:#839496;">$data</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@param </span><span style="color:#93a1a1;font-style:italic;">string $view<br></span><span style="color:#93a1a1;font-style:italic;">     */<br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">public final function </span><span style="color:#839496;">display</span>(<span style="color:#839496;">string $view</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">templatePHP</span>(<span style="color:#839496;">$view</span>);<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@param </span><span style="color:#93a1a1;font-style:italic;">string $view<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">判断是否开启</span><span style="color:#93a1a1;font-style:italic;">PHP</span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">模板缓存以及生存模板缓存<br></span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">     </span><span style="color:#93a1a1;font-style:italic;">*/<br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">templatePHP</span>(<span style="color:#839496;">string $view</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$file</span><span style="color:#079a71;">=</span><span style="color:#d33682;">WEB_PATH</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'View/Cache/PHP/'</span><span style="color:#079a71;">.</span><span style="color:#839496;">md5</span>(<span style="color:#839496;">$view</span>)<span style="color:#079a71;">.</span><span style="color:#2aa198;">'.php'</span>;<br>        <span style="color:#268bd2;">$tp</span><span style="color:#079a71;">=</span><span style="color:#b58900;">Template</span><span style="color:#079a71;">::</span><span style="color:#969483;">getInstance</span>();<br>        <span style="color:#859900;">if </span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_data</span><span style="color:#079a71;">!=</span><span style="color:#859900;">null</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;">extract</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_data</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if</span>(<span style="color:#d33682;">CACHE_PHP</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span><span style="color:#839496;">file_exists</span>(<span style="color:#268bd2;">$file</span>))<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$tp</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">template</span>(<span style="color:#839496;">$view</span>);<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">else<br></span><span style="color:#859900;">            </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">cachePHPCheck</span>(<span style="color:#839496;">$view</span>);<br>                <span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span><span style="color:#839496;">file_exists</span>(<span style="color:#268bd2;">$file</span>))<br>                <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                    </span><span style="color:#268bd2;">$tp</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">template</span>(<span style="color:#839496;">$view</span>);<br>                <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            }<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">templateHtml</span>(<span style="color:#839496;">$view</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">else<br></span><span style="color:#859900;">        </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$tp</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">template</span>(<span style="color:#839496;">$view</span>);<br>            <span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">templateHtml</span>(<span style="color:#839496;">$view</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@param </span><span style="color:#93a1a1;font-style:italic;">string $view<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">判断是否开启</span><span style="color:#93a1a1;font-style:italic;">HTML</span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">缓存以及生产</span><span style="color:#93a1a1;font-style:italic;">HTML</span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">缓存<br></span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">     </span><span style="color:#93a1a1;font-style:italic;">*/<br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">templateHtml</span>(<span style="color:#839496;">string $view</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#d33682;">CACHE_HTML</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">cacheHTMLCheck</span>();<br>            <span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">createHtml</span>(<span style="color:#839496;">$view</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">else<br></span><span style="color:#859900;">        </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">if </span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_data</span><span style="color:#079a71;">!=</span><span style="color:#859900;">null</span>)<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#839496;">extract</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_data</span>);<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$file</span><span style="color:#079a71;">=</span><span style="color:#d33682;">WEB_PATH</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'View/Cache/PHP/'</span><span style="color:#079a71;">.</span><span style="color:#839496;">md5</span>(<span style="color:#839496;">$view</span>)<span style="color:#079a71;">.</span><span style="color:#2aa198;">'.php'</span>;<br>            <span style="color:#859900;">if</span>(<span style="color:#839496;">file_exists</span>(<span style="color:#268bd2;">$file</span>))<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#859900;">require_once </span><span style="color:#268bd2;">$file</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">''</span>;<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">else<br></span><span style="color:#859900;">            </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#839496;">GetError</span>(<span style="color:#839496;">$view</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">' </span><span style="color:#2aa198;font-family:'Courier New';">模板不存在</span><span style="color:#2aa198;">'</span><span style="color:#079a71;">.</span><span style="color:#d33682;">__FUNCTION__</span>);<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        }<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@return </span><span style="color:#93a1a1;font-style:italic;">array<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">获取</span><span style="color:#93a1a1;font-style:italic;">url</span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">相应的参数<br></span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">     </span><span style="color:#93a1a1;font-style:italic;">*/<br></span><span style="color:#93a1a1;font-style:italic;"><br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">final function </span><span style="color:#839496;">params</span>()<span style="color:#079a71;">:</span><span style="color:#859900;">array<br></span><span style="color:#859900;">    </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$params</span><span style="color:#079a71;">=</span><span style="color:#859900;">array</span>();<br>        <span style="color:#859900;">if</span>(<span style="color:#268bd2;">$_SERVER[</span><span style="color:#2aa198;">'REQUEST_METHOD'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">==</span><span style="color:#2aa198;">'GET'</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$route</span><span style="color:#079a71;">=</span><span style="color:#b58900;">Route</span><span style="color:#079a71;">::</span><span style="color:#969483;">getInstance</span>();<br>            <span style="color:#268bd2;">$params</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$route</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">getParams</span>();<br><br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">elseif</span>(<span style="color:#268bd2;">$_SERVER[</span><span style="color:#2aa198;">'REQUEST_METHOD'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">==</span><span style="color:#2aa198;">'POST'</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$params</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$_POST</span>;<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if</span>(<span style="color:#d33682;">MAGIC_GPC</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">return </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">filterGPCParams</span>(<span style="color:#268bd2;">$params</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">else<br></span><span style="color:#859900;">        </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">return </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">filterParams</span>(<span style="color:#268bd2;">$params</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@param </span><span style="color:#93a1a1;font-style:italic;">array $params<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@return </span><span style="color:#93a1a1;font-style:italic;">array<br></span><span style="color:#93a1a1;font-style:italic;">     */<br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">filterParams</span>(<span style="color:#859900;">array </span><span style="color:#839496;">$params</span>)<span style="color:#079a71;">:</span><span style="color:#859900;">array<br></span><span style="color:#859900;">    </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">foreach </span>(<span style="color:#839496;">$params </span><span style="color:#859900;">as </span><span style="color:#268bd2;">$key</span><span style="color:#079a71;">=&gt;</span><span style="color:#268bd2;">$value</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">if</span>(<span style="color:#839496;">is_string</span>(<span style="color:#268bd2;">$value</span>))<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#839496;">$params</span><span style="color:#268bd2;">[$key]</span><span style="color:#079a71;">=</span><span style="color:#839496;">addslashes</span>(<span style="color:#839496;">strip_tags</span>(<span style="color:#839496;">htmlentities</span>(<span style="color:#268bd2;">$value</span>,<span style="color:#d33682;">ENT_QUOTES</span>)));<br><br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">elseif</span>(<span style="color:#839496;">is_array</span>(<span style="color:#268bd2;">$value</span>))<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#839496;">$params</span><span style="color:#268bd2;">[$key]</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">filterParams</span>(<span style="color:#268bd2;">$value</span>);<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        }<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return </span><span style="color:#839496;">$params</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@param </span><span style="color:#93a1a1;font-style:italic;">array $params<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@return </span><span style="color:#93a1a1;font-style:italic;">array<br></span><span style="color:#93a1a1;font-style:italic;">     */<br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">filterGPCParams</span>(<span style="color:#859900;">array </span><span style="color:#839496;">$params</span>)<span style="color:#079a71;">:</span><span style="color:#859900;">array<br></span><span style="color:#859900;">    </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">foreach </span>(<span style="color:#839496;">$params </span><span style="color:#859900;">as </span><span style="color:#268bd2;">$key</span><span style="color:#079a71;">=&gt;</span><span style="color:#268bd2;">$value</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">if</span>(<span style="color:#839496;">is_string</span>(<span style="color:#268bd2;">$value</span>))<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#839496;">$params</span><span style="color:#268bd2;">[$key]</span><span style="color:#079a71;">=</span><span style="color:#839496;">strip_tags</span>(<span style="color:#839496;">htmlentities</span>(<span style="color:#268bd2;">$value</span>,<span style="color:#d33682;">ENT_QUOTES</span>));<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">elseif</span>(<span style="color:#839496;">is_array</span>(<span style="color:#268bd2;">$value</span>))<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#839496;">$params</span><span style="color:#268bd2;">[$key]</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">filterGPCParams</span>(<span style="color:#268bd2;">$value</span>);<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        }<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return </span><span style="color:#839496;">$params</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@param </span><span style="color:#93a1a1;font-style:italic;">string $view<br></span><span style="color:#93a1a1;font-style:italic;">     */<br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">createHtml</span>(<span style="color:#839496;">string $view</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$FName</span><span style="color:#079a71;">=</span><span style="color:#839496;">md5</span>(<span style="color:#b58900;">Route</span><span style="color:#079a71;">::</span><span style="color:#969483;">getInstance</span>()<span style="color:#079a71;">-&gt;</span><span style="color:#839496;">getControl</span>()<span style="color:#079a71;">.</span><span style="color:#b58900;">Route</span><span style="color:#079a71;">::</span><span style="color:#969483;">getInstance</span>()<span style="color:#079a71;">-&gt;</span><span style="color:#839496;">getAction</span>());<br>        <span style="color:#268bd2;">$cacheFile</span><span style="color:#079a71;">=</span><span style="color:#d33682;">WEB_PATH</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'View/Cache/HTML/'</span><span style="color:#079a71;">.</span><span style="color:#268bd2;">$FName</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'.html'</span>;<br>        <span style="color:#268bd2;">$file</span><span style="color:#079a71;">=</span><span style="color:#d33682;">WEB_PATH</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'View/Cache/PHP/'</span><span style="color:#079a71;">.</span><span style="color:#839496;">$view</span>;<br>        <span style="color:#859900;">if </span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_data</span><span style="color:#079a71;">!=</span><span style="color:#859900;">null</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;">extract</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_data</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if</span>(<span style="color:#839496;">file_exists</span>(<span style="color:#268bd2;">$file</span>))<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;">ob_start</span>();<br>            <span style="color:#859900;">require_once </span><span style="color:#268bd2;">$file</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">''</span>;<br>            <span style="color:#268bd2;">$contents </span><span style="color:#079a71;">= </span><span style="color:#839496;">ob_get_contents</span>();<br>            <span style="color:#839496;">file_put_contents</span>(<span style="color:#268bd2;">$cacheFile</span>,<span style="color:#268bd2;">$contents</span>);<br>            <span style="color:#839496;">ob_end_flush</span>();<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">else<br></span><span style="color:#859900;">        </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;">GetError</span>(<span style="color:#839496;">$view</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">' </span><span style="color:#2aa198;font-family:'Courier New';">模板不存在</span><span style="color:#2aa198;">'</span><span style="color:#079a71;">.</span><span style="color:#d33682;">__FUNCTION__</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     *<br></span><span style="color:#93a1a1;font-style:italic;">     */<br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">cacheHTMLCheck</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$FName</span><span style="color:#079a71;">=</span><span style="color:#839496;">md5</span>(<span style="color:#b58900;">Route</span><span style="color:#079a71;">::</span><span style="color:#969483;">getInstance</span>()<span style="color:#079a71;">-&gt;</span><span style="color:#839496;">getControl</span>()<span style="color:#079a71;">.</span><span style="color:#b58900;">Route</span><span style="color:#079a71;">::</span><span style="color:#969483;">getInstance</span>()<span style="color:#079a71;">-&gt;</span><span style="color:#839496;">getAction</span>());<br>        <span style="color:#268bd2;">$cacheFile</span><span style="color:#079a71;">=</span><span style="color:#d33682;">WEB_PATH</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'View/Cache/HTML/'</span><span style="color:#079a71;">.</span><span style="color:#268bd2;">$FName</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'.html'</span>;<br>        <span style="color:#859900;">if </span>(<span style="color:#839496;">is_file</span>(<span style="color:#268bd2;">$cacheFile</span>))<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$aTime</span><span style="color:#079a71;">=</span><span style="color:#839496;">fileatime</span>(<span style="color:#268bd2;">$cacheFile</span>);<br>            <span style="color:#859900;">if </span>((<span style="color:#839496;">time</span>()<span style="color:#079a71;">-</span><span style="color:#268bd2;">$aTime</span>)<span style="color:#079a71;">&gt;</span><span style="color:#d33682;">CACHE_TIME</span>)<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#839496;">unlink</span>(<span style="color:#268bd2;">$cacheFile</span>);<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">else<br></span><span style="color:#859900;">            </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#859900;">require_once </span><span style="color:#268bd2;">$cacheFile</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">''</span>;<br>                <span style="color:#859900;">exit</span>();<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        }<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@param </span><span style="color:#93a1a1;font-style:italic;">string $view<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@param </span><span style="color:#93a1a1;font-style:italic;">int $cacheTime<br></span><span style="color:#93a1a1;font-style:italic;">     */<br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">cachePHPCheck</span>(<span style="color:#839496;">string $view</span>,<span style="color:#839496;">int $cacheTime</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">200</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if</span>(<span style="color:#d33682;">CACHE_PHP</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;">$view</span><span style="color:#079a71;">=</span><span style="color:#839496;">md5</span>(<span style="color:#839496;">$view</span>)<span style="color:#079a71;">.</span><span style="color:#2aa198;">'.php'</span>;<br>            <span style="color:#268bd2;">$cacheFile</span><span style="color:#079a71;">=</span><span style="color:#d33682;">WEB_PATH</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'View/Cache/PHP/'</span><span style="color:#079a71;">.</span><span style="color:#839496;">$view</span>;<br>            <span style="color:#859900;">if </span>(<span style="color:#839496;">is_file</span>(<span style="color:#268bd2;">$cacheFile</span>))<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$aTime</span><span style="color:#079a71;">=</span><span style="color:#839496;">fileatime</span>(<span style="color:#268bd2;">$cacheFile</span>);<br>                <span style="color:#859900;">if </span>((<span style="color:#839496;">time</span>()<span style="color:#079a71;">-</span><span style="color:#268bd2;">$aTime</span>)<span style="color:#079a71;">&gt;</span><span style="color:#839496;">$cacheTime</span>)<br>                <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                    </span><span style="color:#839496;">unlink</span>(<span style="color:#268bd2;">$cacheFile</span>);<br>                <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">                </span><span style="color:#859900;">else<br></span><span style="color:#859900;">                </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                    </span><span style="color:#859900;">require_once </span><span style="color:#268bd2;">$cacheFile</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">''</span>;<br>                    <span style="color:#859900;">exit</span>();<br>                <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            }<br></span><span style="color:#dc322f;">        }<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;">}</span></pre>