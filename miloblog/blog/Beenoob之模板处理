  
	<pre style="background-color:#fdf6e3;color:#586e75;font-family:'Source Code Pro';font-size:13.5pt;"><span style="color:#dc322f;">&lt;?php<br></span><span style="color:#859900;">namespace </span><span style="color:#839496;">Core</span>\<span style="color:#839496;">libs</span>;<br><span style="color:#839496;">defined</span>(<span style="color:#2aa198;">'CORE_PATH'</span>) <span style="color:#859900;">or exit</span>();<br><br><span style="color:#859900;">class </span><span style="color:#839496;background-color:#ccccff;">Template</span><span style="color:#839496;"><br></span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private static </span><span style="color:#d33682;">$_instance</span>;<br><br>    <span style="color:#859900;">private function </span><span style="color:#839496;">__construct</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">public static function </span><span style="color:#839496;">getInstance</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span>(<span style="color:#839496;background-color:#ccccff;">self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance </span><span style="color:#859900;">instanceof </span><span style="color:#839496;background-color:#ccccff;">self</span>)) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;background-color:#ccccff;">self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance </span><span style="color:#079a71;">= </span><span style="color:#859900;">new </span><span style="color:#839496;background-color:#ccccff;">self</span>();<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return </span><span style="color:#839496;background-color:#ccccff;">self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">__clone</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">public function </span><span style="color:#839496;">template</span>(<span style="color:#839496;">string $view</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$file </span><span style="color:#079a71;">= </span><span style="color:#d33682;">WEB_PATH </span><span style="color:#079a71;">. </span><span style="color:#2aa198;">'/View/Templates/' </span><span style="color:#079a71;">. </span><span style="color:#839496;">$view</span>;<br>        <span style="color:#859900;">if </span>(<span style="color:#839496;">file_exists</span>(<span style="color:#268bd2;">$file</span>)) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$contents </span><span style="color:#079a71;">= </span><span style="color:#839496;">file_get_contents</span>(<span style="color:#268bd2;">$file</span>);<br>            <span style="color:#268bd2;">$pattern </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">'/\{ *\$([a-zA-Z_].*) *\}/U'</span>;<br>            <span style="color:#268bd2;">$contents </span><span style="color:#079a71;">= </span><span style="color:#839496;">preg_replace</span>(<span style="color:#268bd2;">$pattern</span>, <span style="color:#2aa198;">'&lt;?php echo $$1; ?&gt;'</span>, <span style="color:#268bd2;">$contents</span>);<br>            <span style="color:#268bd2;">$pattern </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">'/\{ *(while *\(.*\)|switch *\(.*\)|case .*|foreach *\(.*\)|for *\(.*\)|else|elseif *\(.*\)|if *\(.*\)) *\}/'</span>;<br>            <span style="color:#268bd2;">$contents </span><span style="color:#079a71;">= </span><span style="color:#839496;">preg_replace</span>(<span style="color:#268bd2;">$pattern</span>, <span style="color:#2aa198;">'&lt;?php $1: ?&gt;'</span>, <span style="color:#268bd2;">$contents</span>);<br>            <span style="color:#268bd2;">$pattern </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">'/\{\/ *(endwhile|endfor|break|endswitch|endif|endforeach) *\}/'</span>;<br>            <span style="color:#268bd2;">$contents </span><span style="color:#079a71;">= </span><span style="color:#839496;">preg_replace</span>(<span style="color:#268bd2;">$pattern</span>, <span style="color:#2aa198;">'&lt;?php $1; ?&gt;'</span>, <span style="color:#268bd2;">$contents</span>);<br>            <span style="color:#268bd2;">$template </span><span style="color:#079a71;">= </span><span style="color:#d33682;">WEB_PATH </span><span style="color:#079a71;">. </span><span style="color:#2aa198;">'/View/Cache/PHP/' </span><span style="color:#079a71;">. </span><span style="color:#839496;">md5</span>(<span style="color:#839496;">$view</span>) <span style="color:#079a71;">. </span><span style="color:#2aa198;">'.php'</span>;<br>            <span style="color:#839496;">file_put_contents</span>(<span style="color:#268bd2;">$template</span>, <span style="color:#268bd2;">$contents</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;">}</span></pre>