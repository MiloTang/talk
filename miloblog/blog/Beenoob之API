  
	<pre style="background-color:#fdf6e3;color:#586e75;font-family:'Source Code Pro';font-size:13.5pt;"><span style="color:#dc322f;">&lt;?php<br></span><span style="color:#859900;">namespace </span><span style="color:#839496;">Core</span>\<span style="color:#839496;">Libs</span>;<br><span style="color:#839496;">defined</span>(<span style="color:#2aa198;">'CORE_PATH'</span>) <span style="color:#859900;">or exit</span>();<br><span style="color:#859900;">class </span><span style="color:#b58900;">Api<br></span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private static </span><span style="color:#d33682;">$_instance</span>;<br>    <span style="color:#859900;">private </span><span style="color:#6c71c4;">$mxl</span>;<br>    <span style="color:#859900;">private function </span><span style="color:#839496;">__construct</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">public static function </span><span style="color:#839496;">getInstance</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span>(<span style="color:#859900;">self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance </span><span style="color:#859900;">instanceof </span><span style="color:#b58900;">self</span>))<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance </span><span style="color:#079a71;">= </span><span style="color:#859900;">new self</span>();<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">__clone</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">public function </span><span style="color:#839496;">getApi</span>(<span style="color:#839496;">int $code</span>,<span style="color:#839496;">$message</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">''</span>,<span style="color:#839496;">$data</span><span style="color:#079a71;">=</span><span style="color:#859900;">array</span>(),<span style="color:#839496;">string $type</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">'json'</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span><span style="color:#839496;">is_numeric</span>(<span style="color:#839496;">$code</span>))<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;">GetError</span>(<span style="color:#2aa198;">'code must be int type'</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$result</span><span style="color:#079a71;">=</span><span style="color:#859900;">array</span>(<br>            <span style="color:#2aa198;">'code'</span><span style="color:#079a71;">=&gt;</span><span style="color:#839496;">$code</span>,<br>            <span style="color:#2aa198;">'message'</span><span style="color:#079a71;">=&gt;</span><span style="color:#839496;">$message</span>,<br>            <span style="color:#2aa198;">'data'</span><span style="color:#079a71;">=&gt;</span><span style="color:#839496;">$data<br></span><span style="color:#839496;">        </span>);<br>        <span style="color:#859900;">if </span>(<span style="color:#839496;">$type</span><span style="color:#079a71;">==</span><span style="color:#2aa198;">'json'</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">getJson</span>(<span style="color:#839496;">$code</span>,<span style="color:#839496;">$message</span>,<span style="color:#839496;">$data</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">elseif</span>(<span style="color:#839496;">$type</span><span style="color:#079a71;">==</span><span style="color:#2aa198;">'xml'</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">getXml</span>(<span style="color:#839496;">$code</span>,<span style="color:#839496;">$message</span>,<span style="color:#839496;">$data</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">elseif</span>(<span style="color:#839496;">$type</span><span style="color:#079a71;">==</span><span style="color:#2aa198;">'array'</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;">PrintFm</span>(<span style="color:#268bd2;">$result</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">else<br></span><span style="color:#859900;">        </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;">GetError</span>(<span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">格式类型有误</span><span style="color:#2aa198;">,</span><span style="color:#2aa198;font-family:'Courier New';">只支持</span><span style="color:#2aa198;">json</span><span style="color:#2aa198;font-family:'Courier New';">和</span><span style="color:#2aa198;">xml</span><span style="color:#2aa198;font-family:'Courier New';">类型</span><span style="color:#2aa198;">'</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private  function </span><span style="color:#839496;">getJson</span>(<span style="color:#839496;">int $code</span>,<span style="color:#839496;">$message</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">''</span>,<span style="color:#839496;">$data</span><span style="color:#079a71;">=</span><span style="color:#859900;">array</span>())<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$json</span><span style="color:#079a71;">=</span><span style="color:#859900;">array</span>(<br>            <span style="color:#2aa198;">'code'</span><span style="color:#079a71;">=&gt;</span><span style="color:#839496;">$code</span>,<br>            <span style="color:#2aa198;">'message'</span><span style="color:#079a71;">=&gt;</span><span style="color:#839496;">$message</span>,<br>            <span style="color:#2aa198;">'data'</span><span style="color:#079a71;">=&gt;</span><span style="color:#839496;">$data<br></span><span style="color:#839496;">        </span>);<br>        <span style="color:#859900;">echo </span><span style="color:#839496;">json_encode</span>(<span style="color:#268bd2;">$json</span>);<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private  function </span><span style="color:#839496;">getXml</span>(<span style="color:#839496;">int $code</span>,<span style="color:#839496;">string $message</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">''</span>,<span style="color:#859900;">array </span><span style="color:#839496;">$data</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$xmlArr</span><span style="color:#079a71;">=</span><span style="color:#859900;">array</span>(<br>            <span style="color:#2aa198;">'code'</span><span style="color:#079a71;">=&gt;</span><span style="color:#839496;">$code</span>,<br>            <span style="color:#2aa198;">'massage'</span><span style="color:#079a71;">=&gt;</span><span style="color:#839496;">$message</span>,<br>            <span style="color:#2aa198;">'data'</span><span style="color:#079a71;">=&gt;</span><span style="color:#839496;">$data<br></span><span style="color:#839496;">        </span>);<br>        <span style="color:#839496;">header</span>(<span style="color:#2aa198;">'Content-Type:text/xml'</span>);<br>        <span style="color:#268bd2;">$xml</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">'&lt;?xml version="1.0" encoding="utf-8"?&gt;'</span><span style="color:#079a71;">.</span><span style="color:#d33682;">PHP_EOL</span>;<br>        <span style="color:#268bd2;">$xml</span><span style="color:#079a71;">.=</span><span style="color:#2aa198;">'&lt;root&gt;'</span><span style="color:#079a71;">.</span><span style="color:#d33682;">PHP_EOL</span>;<br>        <span style="color:#268bd2;">$xml</span><span style="color:#079a71;">.=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">xmlArr</span>(<span style="color:#268bd2;">$xmlArr</span>);<br>        <span style="color:#268bd2;">$xml</span><span style="color:#079a71;">.=</span><span style="color:#2aa198;">'&lt;/root&gt;'</span>;<br>        <span style="color:#859900;">echo </span><span style="color:#268bd2;">$xml</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private  function </span><span style="color:#839496;">xmlArr</span>(<span style="color:#859900;">array </span><span style="color:#839496;">$data</span>)<span style="color:#079a71;">:</span><span style="color:#839496;">string <br></span><span style="color:#839496;">    </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$xml</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">''</span>;<br>        <span style="color:#268bd2;">$attr</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">''</span>;<br>        <span style="color:#859900;">foreach </span>(<span style="color:#839496;">$data </span><span style="color:#859900;">as </span><span style="color:#268bd2;">$key</span><span style="color:#079a71;">=&gt;</span><span style="color:#268bd2;">$value</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">if</span>(<span style="color:#839496;">is_numeric</span>(<span style="color:#268bd2;">$key</span>))<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$attr</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">"id='</span><span style="color:#dc322f;">{</span><span style="color:#268bd2;">$key</span><span style="color:#dc322f;">}</span><span style="color:#2aa198;">'"</span>;<br>                <span style="color:#268bd2;">$key</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">'item'</span>;<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$xml</span><span style="color:#079a71;">.=</span><span style="color:#2aa198;">"&lt;</span><span style="color:#268bd2;">$key </span><span style="color:#dc322f;">{</span><span style="color:#268bd2;">$attr</span><span style="color:#dc322f;">}</span><span style="color:#2aa198;">&gt;"</span>;<br>            <span style="color:#268bd2;">$xml</span><span style="color:#079a71;">.=</span><span style="color:#839496;">is_array</span>(<span style="color:#268bd2;">$value</span>)<span style="color:#079a71;">?</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">xmlArr</span>(<span style="color:#268bd2;">$value</span>)<span style="color:#079a71;">:</span><span style="color:#268bd2;">$value</span>;<br>            <span style="color:#268bd2;">$xml</span><span style="color:#079a71;">.=</span><span style="color:#2aa198;">'&lt;/'</span><span style="color:#079a71;">.</span><span style="color:#268bd2;">$key</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'&gt;'</span><span style="color:#079a71;">.</span><span style="color:#d33682;">PHP_EOL</span>;<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return </span><span style="color:#268bd2;">$xml</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">}</span></pre>