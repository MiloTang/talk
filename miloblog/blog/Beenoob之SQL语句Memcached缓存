  
	<pre style="background-color:#fdf6e3;color:#586e75;font-family:'Source Code Pro';font-size:13.5pt;"><span style="color:#dc322f;">&lt;?php<br></span><span style="color:#859900;">namespace </span><span style="color:#839496;">Core</span>\<span style="color:#839496;">Libs</span>;<br><span style="color:#839496;">defined</span>(<span style="color:#2aa198;">'CORE_PATH'</span>) <span style="color:#859900;">or exit</span>();<br><span style="color:#859900;">class </span><span style="color:#b58900;">MemCachedCache </span><span style="color:#859900;">implements </span><span style="color:#839496;">MemoryCache<br></span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private static </span><span style="color:#d33682;">$_instance</span>;<br>    <span style="color:#859900;">private </span><span style="color:#6c71c4;">$_ip</span>;<br>    <span style="color:#859900;">private </span><span style="color:#6c71c4;">$_port</span>;<br>    <span style="color:#859900;">private </span><span style="color:#6c71c4;">$_memcached</span>;<br>    <span style="color:#859900;">private function </span><span style="color:#839496;">__construct</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#859900;">isset</span>(<span style="color:#b58900;">Conf</span><span style="color:#079a71;">::</span><span style="color:#969483;">conf</span>()<span style="color:#268bd2;">[</span><span style="color:#2aa198;">'Redis'</span><span style="color:#268bd2;">][</span><span style="color:#2aa198;">'ip'</span><span style="color:#268bd2;">]</span>)<span style="color:#079a71;">&amp;&amp;</span><span style="color:#859900;">isset</span>(<span style="color:#b58900;">Conf</span><span style="color:#079a71;">::</span><span style="color:#969483;">conf</span>()<span style="color:#268bd2;">[</span><span style="color:#2aa198;">'Redis'</span><span style="color:#268bd2;">][</span><span style="color:#2aa198;">'port'</span><span style="color:#268bd2;">]</span>))<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_ip</span><span style="color:#079a71;">=</span><span style="color:#b58900;">Conf</span><span style="color:#079a71;">::</span><span style="color:#969483;">conf</span>()<span style="color:#268bd2;">[</span><span style="color:#2aa198;">'Redis'</span><span style="color:#268bd2;">][</span><span style="color:#2aa198;">'ip'</span><span style="color:#268bd2;">]</span>;<br>            <span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_port</span><span style="color:#079a71;">=</span><span style="color:#b58900;">Conf</span><span style="color:#079a71;">::</span><span style="color:#969483;">conf</span>()<span style="color:#268bd2;">[</span><span style="color:#2aa198;">'Redis'</span><span style="color:#268bd2;">][</span><span style="color:#2aa198;">'port'</span><span style="color:#268bd2;">]</span>;<br>            <span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_memcached </span><span style="color:#079a71;">= </span><span style="color:#859900;">new </span>\<span style="color:#839496;">Memcached</span>();<br>            <span style="color:#859900;">try<br></span><span style="color:#859900;">            </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_memcached</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">addServer</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_ip</span>,<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_port</span>);<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">catch </span>(\<span style="color:#839496;">MemcachedException </span><span style="color:#268bd2;">$e</span>)<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#839496;">GetError</span>(<span style="color:#268bd2;">$e</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">getMessage</span>());<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">        }<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">else<br></span><span style="color:#859900;">        </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;">GetError</span>(<span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">请检查配置文件</span><span style="color:#2aa198;">Memcached'</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">public static function </span><span style="color:#839496;">getInstance</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span>(<span style="color:#859900;">self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance </span><span style="color:#859900;">instanceof self</span>)) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance </span><span style="color:#079a71;">= </span><span style="color:#859900;">new self</span>();<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">__clone</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">public function </span><span style="color:#839496;">setCache</span>(<span style="color:#839496;">string $sql</span>,<span style="color:#859900;">array </span><span style="color:#839496;">$data</span>)<span style="color:#079a71;">:</span><span style="color:#839496;">bool<br></span><span style="color:#839496;">    </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">getCache</span>(<span style="color:#839496;">$sql</span>)<span style="color:#079a71;">==</span><span style="color:#859900;">null</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_memcached</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">set</span>(<span style="color:#839496;">$sql</span>,<span style="color:#839496;">$data</span>);<br>            <span style="color:#859900;">return true</span>;<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return false</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">public function </span><span style="color:#839496;">getCache</span>(<span style="color:#839496;">string $sql</span>)<span style="color:#079a71;">:</span><span style="color:#859900;">array<br></span><span style="color:#859900;">    </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$data</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">_memcached</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">get</span>(<span style="color:#839496;">$sql</span>);<br>        <span style="color:#859900;">return </span><span style="color:#268bd2;">$data</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">}</span></pre>