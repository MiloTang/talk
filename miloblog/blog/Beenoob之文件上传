<pre style="background-color:#fdf6e3;color:#586e75;font-family:'Source Code Pro';font-size:13.5pt;"><span style="color:#dc322f;">&lt;?php<br></span><span style="color:#859900;">namespace </span><span style="color:#839496;">Core</span>\<span style="color:#839496;">Libs</span>;<br><span style="color:#859900;">class </span><span style="color:#b58900;">UploadFile<br></span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private static </span><span style="color:#d33682;">$_instance</span>;<br>    <span style="color:#859900;">protected static </span><span style="color:#d33682;">$filename</span><span style="color:#079a71;">=</span><span style="color:#859900;">array</span>();<br>    <span style="color:#859900;">protected </span><span style="color:#6c71c4;">$fileInfo</span>;<br>    <span style="color:#859900;">protected </span><span style="color:#6c71c4;">$msg</span>;<br>    <span style="color:#859900;">protected </span><span style="color:#6c71c4;">$allowedType</span>;<br>    <span style="color:#859900;">protected </span><span style="color:#6c71c4;">$maxSize</span>;<br>    <span style="color:#859900;">protected </span><span style="color:#6c71c4;">$ext</span>;<br>    <span style="color:#859900;">private function </span><span style="color:#839496;">__construct</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">public static function </span><span style="color:#839496;">getInstance</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span>(<span style="color:#859900;">self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance </span><span style="color:#859900;">instanceof self</span>)) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance </span><span style="color:#079a71;">= </span><span style="color:#859900;">new self</span>();<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$_instance</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">private function </span><span style="color:#839496;">__clone</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">public function </span><span style="color:#839496;">uploads</span>(<span style="color:#839496;">$allowedType</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">'Image'</span>,<span style="color:#839496;">$maxSize</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">1046576</span>)<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">allowedType</span><span style="color:#079a71;">=</span><span style="color:#839496;">$allowedType</span>;<br>        <span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">maxSize</span><span style="color:#079a71;">=</span><span style="color:#839496;">$maxSize</span>;<br>        <span style="color:#859900;">foreach </span>(<span style="color:#268bd2;">$_FILES </span><span style="color:#859900;">as </span><span style="color:#268bd2;">$files</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">if </span>(<span style="color:#839496;">is_array</span>(<span style="color:#268bd2;">$files[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">]</span>))<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$i</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">0</span>;<br>                <span style="color:#859900;">foreach </span>(<span style="color:#268bd2;">$files[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">] </span><span style="color:#859900;">as </span><span style="color:#268bd2;">$item </span><span style="color:#079a71;">=&gt; </span><span style="color:#268bd2;">$value</span>)<br>                <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                    </span><span style="color:#268bd2;">$fileInfo[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$files[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">][$i]</span>;<br>                    <span style="color:#268bd2;">$fileInfo[</span><span style="color:#2aa198;">'type'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$files[</span><span style="color:#2aa198;">'type'</span><span style="color:#268bd2;">][$i]</span>;<br>                    <span style="color:#268bd2;">$fileInfo[</span><span style="color:#2aa198;">'tmp_name'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$files[</span><span style="color:#2aa198;">'tmp_name'</span><span style="color:#268bd2;">][$i]</span>;<br>                    <span style="color:#268bd2;">$fileInfo[</span><span style="color:#2aa198;">'error'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$files[</span><span style="color:#2aa198;">'error'</span><span style="color:#268bd2;">][$i]</span>;<br>                    <span style="color:#268bd2;">$fileInfo[</span><span style="color:#2aa198;">'size'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$files[</span><span style="color:#2aa198;">'size'</span><span style="color:#268bd2;">][$i]</span>;<br>                    <span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$fileInfo</span>;<br>                    <span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">uploadCheck</span>();<br>                    <span style="color:#268bd2;">$i</span><span style="color:#079a71;">++</span>;<br>                <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            }<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">else<br></span><span style="color:#859900;">            </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$fileInfo</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$files</span>;<br>                <span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$fileInfo</span>;<br>                <span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">uploadCheck</span>();<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        }<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">protected function </span><span style="color:#839496;">uploadCheck</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span><span style="color:#839496;">is_null</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span>))<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">if </span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">checkError</span>()<span style="color:#079a71;">&amp;&amp;</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">checkSize</span>()<span style="color:#079a71;">&amp;&amp;</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">checkType</span>()<span style="color:#079a71;">&amp;&amp;</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">checkUploadType</span>())<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">               </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">upload</span>();<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        }<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">else<br></span><span style="color:#859900;">        </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">文件并不存在</span><span style="color:#2aa198;">'</span>;<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#839496;">PrintFm</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span>);<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">protected function </span><span style="color:#839496;">checkError</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'error'</span><span style="color:#268bd2;">] </span><span style="color:#079a71;">&gt; </span><span style="color:#2aa198;">0</span>) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">switch </span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'error'</span><span style="color:#268bd2;">]</span>) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#859900;">case </span><span style="color:#2aa198;">1</span><span style="color:#079a71;">:<br></span><span style="color:#079a71;">                    </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">= </span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">上传的文件超过服务器限制</span><span style="color:#2aa198;">'</span>;<br>                    <span style="color:#859900;">break</span>;<br>                <span style="color:#859900;">case </span><span style="color:#2aa198;">2</span><span style="color:#079a71;">:<br></span><span style="color:#079a71;">                    </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">超过了表单中的最大值</span><span style="color:#2aa198;">'</span>;<br>                    <span style="color:#859900;">break</span>;<br>                <span style="color:#859900;">case </span><span style="color:#2aa198;">3</span><span style="color:#079a71;">:<br></span><span style="color:#079a71;">                    </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">文件部分上传</span><span style="color:#2aa198;">'</span>;<br>                    <span style="color:#859900;">break</span>;<br>                <span style="color:#859900;">case </span><span style="color:#2aa198;">4</span><span style="color:#079a71;">:<br></span><span style="color:#079a71;">                    </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">没有选择上传文件</span><span style="color:#2aa198;">'</span>;<br>                    <span style="color:#859900;">break</span>;<br>                <span style="color:#859900;">case </span><span style="color:#2aa198;">6</span><span style="color:#079a71;">:<br></span><span style="color:#079a71;">                    </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">没有找到临时目录</span><span style="color:#2aa198;">'</span>;<br>                    <span style="color:#859900;">break</span>;<br>                <span style="color:#859900;">case </span><span style="color:#2aa198;">7</span><span style="color:#079a71;">:<br></span><span style="color:#079a71;">                    </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">文件不可写</span><span style="color:#2aa198;">'</span>;<br>                    <span style="color:#859900;">break</span>;<br>                <span style="color:#859900;">case </span><span style="color:#2aa198;">8</span><span style="color:#079a71;">:<br></span><span style="color:#079a71;">                    </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">由于</span><span style="color:#2aa198;">PHP</span><span style="color:#2aa198;font-family:'Courier New';">扩展程序中断文件上传</span><span style="color:#2aa198;">'</span>;<br>                    <span style="color:#859900;">break</span>;<br>                <span style="color:#859900;">default</span><span style="color:#079a71;">:<br></span><span style="color:#079a71;">                    </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">其他错误</span><span style="color:#2aa198;">'</span>;<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">return false</span>;<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return true</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">protected function </span><span style="color:#839496;">checkSize</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'size'</span><span style="color:#268bd2;">] </span><span style="color:#079a71;">&gt; </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">maxSize</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">           </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">文件上传过大</span><span style="color:#2aa198;">'</span>;<br>            <span style="color:#859900;">return false</span>;<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return true</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">protected function </span><span style="color:#839496;">checkType</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">ext </span><span style="color:#079a71;">= </span><span style="color:#839496;">strtolower</span>(<span style="color:#839496;">pathinfo</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">]</span>, <span style="color:#d33682;">PATHINFO_EXTENSION</span>));<br>        <span style="color:#268bd2;">$conf </span><span style="color:#079a71;">= </span><span style="color:#b58900;">Conf</span><span style="color:#079a71;">::</span><span style="color:#969483;">getInstance</span>()<span style="color:#079a71;">-&gt;</span><span style="color:#839496;">conf</span>();<br>        <span style="color:#859900;">if </span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">ext</span><span style="color:#079a71;">!=</span><span style="color:#2aa198;">'txt'</span>)<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$file </span><span style="color:#079a71;">= </span><span style="color:#839496;">fopen</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'tmp_name'</span><span style="color:#268bd2;">]</span>, <span style="color:#2aa198;">'rb'</span>);<br>            <span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span><span style="color:#268bd2;">$file</span>)<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">读取文件失败</span><span style="color:#2aa198;">'</span>;<br>                <span style="color:#859900;">return false</span>;<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$bin </span><span style="color:#079a71;">= </span><span style="color:#839496;">fread</span>(<span style="color:#268bd2;">$file</span>, <span style="color:#2aa198;">15</span>);<br>            <span style="color:#839496;">fclose</span>(<span style="color:#268bd2;">$file</span>);<br>            <span style="color:#268bd2;">$real </span><span style="color:#079a71;">= </span><span style="color:#859900;">false</span>;<br>            <span style="color:#268bd2;">$realType </span><span style="color:#079a71;">= </span><span style="color:#2aa198;">''</span>;<br>            <span style="color:#268bd2;">$realTypeList</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#839496;">realTypeList</span>();<br>            <span style="color:#859900;">foreach </span>(<span style="color:#268bd2;">$realTypeList </span><span style="color:#859900;">as </span><span style="color:#268bd2;">$v</span>) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$len </span><span style="color:#079a71;">= </span><span style="color:#839496;">strlen</span>(<span style="color:#839496;">pack</span>(<span style="color:#2aa198;">'H*'</span>, <span style="color:#268bd2;">$v[</span><span style="color:#2aa198;">0</span><span style="color:#268bd2;">]</span>));<br>                <span style="color:#268bd2;">$rst </span><span style="color:#079a71;">= </span><span style="color:#839496;">substr</span>(<span style="color:#268bd2;">$bin</span>, <span style="color:#2aa198;">0</span>, <span style="color:#839496;">intval</span>(<span style="color:#268bd2;">$len</span>));<br>                <span style="color:#859900;">if </span>(<span style="color:#839496;">strtolower</span>(<span style="color:#268bd2;">$v[</span><span style="color:#2aa198;">0</span><span style="color:#268bd2;">]</span>) <span style="color:#079a71;">== </span><span style="color:#839496;">strtolower</span>(<span style="color:#839496;">array_shift</span>(<span style="color:#839496;">unpack</span>(<span style="color:#2aa198;">'H*'</span>, <span style="color:#268bd2;">$rst</span>))))<br>                <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                    </span><span style="color:#859900;">if </span>(<span style="color:#268bd2;">$v[</span><span style="color:#2aa198;">1</span><span style="color:#268bd2;">] </span><span style="color:#079a71;">== </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">ext</span>) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                        </span><span style="color:#268bd2;">$real </span><span style="color:#079a71;">= </span><span style="color:#859900;">true</span>;<br>                    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">                    </span><span style="color:#268bd2;">$realType </span><span style="color:#079a71;">= </span><span style="color:#268bd2;">$v[</span><span style="color:#2aa198;">1</span><span style="color:#268bd2;">]</span>;<br>                <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">            }<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span><span style="color:#268bd2;">$real</span>)<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">文件禁止上传其真实格式</span><span style="color:#2aa198;">:'</span><span style="color:#079a71;">.</span><span style="color:#268bd2;">$realType</span>;<br>                <span style="color:#859900;">return false</span>;<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        }<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#859900;">isset</span>(<span style="color:#268bd2;">$conf[</span><span style="color:#2aa198;">'UP_TYPE'</span><span style="color:#268bd2;">][$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">allowedType</span><span style="color:#268bd2;">]</span>))<br>        <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span><span style="color:#839496;">in_array</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">ext</span>, <span style="color:#268bd2;">$conf[</span><span style="color:#2aa198;">'UP_TYPE'</span><span style="color:#268bd2;">][$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">allowedType</span><span style="color:#268bd2;">]</span>))<br>            <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">                </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">不允许此格式</span><span style="color:#2aa198;">'</span>;<br>                <span style="color:#859900;">return false</span>;<br>            <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        }<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">else<br></span><span style="color:#859900;">        </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">=</span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">请检查配置文件</span><span style="color:#2aa198;">'</span>;<br>            <span style="color:#859900;">return false</span>;<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return true</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">protected function </span><span style="color:#839496;">checkUploadType</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span><span style="color:#839496;">is_uploaded_file</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'tmp_name'</span><span style="color:#268bd2;">]</span>)) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">不是</span><span style="color:#2aa198;">POST</span><span style="color:#2aa198;font-family:'Courier New';">方式传递过来的</span><span style="color:#2aa198;">'</span>;<br>            <span style="color:#859900;">return false</span>;<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return true</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">protected function </span><span style="color:#839496;">upload</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$dir </span><span style="color:#079a71;">= </span><span style="color:#d33682;">WEB_PATH </span><span style="color:#079a71;">. </span><span style="color:#2aa198;">'Public/Upload/'</span><span style="color:#079a71;">.</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">allowedType</span>;<br>        <span style="color:#859900;">if </span>(<span style="color:#079a71;">!</span><span style="color:#839496;">is_dir</span>(<span style="color:#268bd2;">$dir</span>)) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#839496;">mkdir</span>(<span style="color:#268bd2;">$dir</span>, <span style="color:#2aa198;">0777</span>, <span style="color:#859900;">true</span>);<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">        </span><span style="color:#268bd2;">$filename </span><span style="color:#079a71;">= </span><span style="color:#839496;">md5</span>(<span style="color:#839496;">uniqid</span>(<span style="color:#839496;">microtime</span>(<span style="color:#859900;">true</span>), <span style="color:#859900;">true</span>)) <span style="color:#079a71;">. </span><span style="color:#2aa198;">'.' </span><span style="color:#079a71;">. </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">ext</span>;<br>        <span style="color:#859900;">if </span>(<span style="color:#839496;">move_uploaded_file</span>(<span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'tmp_name'</span><span style="color:#268bd2;">]</span>,<span style="color:#268bd2;">$dir</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'/'</span><span style="color:#079a71;">.</span><span style="color:#268bd2;">$filename</span>)) <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#859900;">self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$filename</span><span style="color:#268bd2;">[$filename] </span><span style="color:#079a71;">= </span><span style="color:#d33682;">WEB_NAME</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'/Public/Upload/'</span><span style="color:#079a71;">.</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">allowedType</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'/'</span><span style="color:#079a71;">.</span><span style="color:#268bd2;">$filename</span>;<br>            <span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">上传成功</span><span style="color:#2aa198;">'</span>;<br>        <span style="color:#dc322f;">} </span><span style="color:#859900;">else </span><span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">            </span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">msg</span><span style="color:#079a71;">=</span><span style="color:#268bd2;">$this</span><span style="color:#079a71;">-&gt;</span><span style="color:#6c71c4;">fileInfo</span><span style="color:#268bd2;">[</span><span style="color:#2aa198;">'name'</span><span style="color:#268bd2;">]</span><span style="color:#079a71;">.</span><span style="color:#2aa198;">'</span><span style="color:#2aa198;font-family:'Courier New';">上传失败</span><span style="color:#2aa198;">'</span>;<br>        <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    }<br></span><span style="color:#dc322f;"><br></span><span style="color:#dc322f;">    </span><span style="color:#93a1a1;font-style:italic;">/**<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-weight:bold;font-style:italic;">@return </span><span style="color:#93a1a1;font-style:italic;">mixed<br></span><span style="color:#93a1a1;font-style:italic;">     * </span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">当</span><span style="color:#93a1a1;font-style:italic;">upload </span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">返回</span><span style="color:#93a1a1;font-style:italic;">true</span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">时　可以调用<br></span><span style="color:#93a1a1;font-style:italic;font-family:'Courier New';">     </span><span style="color:#93a1a1;font-style:italic;">*/<br></span><span style="color:#93a1a1;font-style:italic;">    </span><span style="color:#859900;">public function </span><span style="color:#839496;">getFileName</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return self</span><span style="color:#079a71;">::</span><span style="color:#d33682;">$filename</span>;<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">    </span><span style="color:#859900;">protected function </span><span style="color:#839496;">realTypeList</span>()<br>    <span style="color:#dc322f;">{<br></span><span style="color:#dc322f;">        </span><span style="color:#859900;">return array</span>(<span style="color:#859900;">array</span>(<span style="color:#2aa198;">'FFD8FFE000'</span>, <span style="color:#2aa198;">'jpg'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'89504E47'</span>, <span style="color:#2aa198;">'png'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'47494638'</span>, <span style="color:#2aa198;">'gif'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'49492A00'</span>, <span style="color:#2aa198;">'tif'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'424D'</span>, <span style="color:#2aa198;">'bmp'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'41433130'</span>, <span style="color:#2aa198;">'dwg'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'38425053'</span>, <span style="color:#2aa198;">'psd'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'7B5C727466'</span>, <span style="color:#2aa198;">'rtf'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'3C3F786D6C'</span>, <span style="color:#2aa198;">'xml'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'68746D6C3E'</span>, <span style="color:#2aa198;">'html'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'44656C69766572792D646174'</span>, <span style="color:#2aa198;">'eml'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'CFAD12FEC5FD746F'</span>, <span style="color:#2aa198;">'dbx'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'2142444E'</span>, <span style="color:#2aa198;">'pst'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'D0CF11E0'</span>, <span style="color:#2aa198;">'doc'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'D0CF11E0'</span>, <span style="color:#2aa198;">'xls'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'5374616E64617264204A'</span>, <span style="color:#2aa198;">'mdb'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'FF575043'</span>, <span style="color:#2aa198;">'wpd'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'252150532D41646F6265'</span>, <span style="color:#2aa198;">'ps'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'252150532D41646F6265'</span>, <span style="color:#2aa198;">'eps'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'255044462D312E'</span>, <span style="color:#2aa198;">'pdf'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'E3828596'</span>, <span style="color:#2aa198;">'pwl'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'504B0304'</span>, <span style="color:#2aa198;">'zip'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'504b0304140006000800000021'</span>,<span style="color:#2aa198;">'docx'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'504b0304140006000800000021'</span>,<span style="color:#2aa198;">'xlsx'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'52617221'</span>, <span style="color:#2aa198;">'rar'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'57415645'</span>, <span style="color:#2aa198;">'wav'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'41564920'</span>, <span style="color:#2aa198;">'avi'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'2E7261FD'</span>, <span style="color:#2aa198;">'ram'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'2E524D46'</span>, <span style="color:#2aa198;">'rm'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'000001BA'</span>, <span style="color:#2aa198;">'mpg'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'000001B3'</span>, <span style="color:#2aa198;">'mpg'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'6D6F6F76'</span>, <span style="color:#2aa198;">'mov'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'3026B2758E66CF11'</span>, <span style="color:#2aa198;">'asf'</span>),<br>            <span style="color:#859900;">array</span>(<span style="color:#2aa198;">'4D546864'</span>, <span style="color:#2aa198;">'mid'</span>));<br>    <span style="color:#dc322f;">}<br></span><span style="color:#dc322f;">}<br></span></pre>